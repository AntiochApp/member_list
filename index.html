<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì„±ë„ ë“±ë¡</title>

  <!-- ëª¨ë°”ì¼ ìµœì í™” -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    /* ì „ì²´ ë°°ê²½ ë° ê¸°ë³¸ í°íŠ¸ */
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #f5f5f5;
    }

    /* ê°€ìš´ë° ì¹´ë“œ í˜•íƒœ ì»¨í…Œì´ë„ˆ */
    .container {
      max-width: 480px;          /* ëª¨ë°”ì¼ ê¸°ì¤€, ë„ˆë¬´ ë„“ì§€ ì•Šê²Œ */
      margin: 20px auto;
      padding: 20px 16px;
      background-color: #ffffff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    h1 {
      font-size: 1.4rem;
      margin-top: 0;
      margin-bottom: 16px;
      text-align: center;
      color: #333;
      cursor: pointer; /* ê´€ë¦¬ììš© ìˆ¨ì€ ë²„íŠ¼ ëŠë‚Œ */
    }

    h2 {
      font-size: 1.1rem;
      margin: 18px 0 10px;
      color: #333;
    }

    .field {
      margin-bottom: 14px;
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 4px;
      color: #444;
    }

    input[type="text"],
    input[type="email"],
    input[type="date"],
    input[type="password"],
    textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
    }

    input:focus,
    textarea:focus {
      outline: none;
      border-color: #4a90e2;
      box-shadow: 0 0 0 2px rgba(74,144,226,0.2);
    }

    button {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      background-color: #4a90e2;
      color: #fff;
      cursor: pointer;
      margin-top: 6px;
    }

    button:active {
      transform: scale(0.99);
    }

    .small-button {
      background-color: #4a90e2;
      font-size: 0.9rem;
      width: auto;
      padding: 6px 10px;
      margin-top: 8px;
    }

    .result {
      margin-top: 12px;
      font-size: 0.9rem;
      text-align: center;
    }

    .success {
      color: #1b8c3f;
    }

    .error {
      color: #d9534f;
    }

    .small {
      font-size: 0.8rem;
      color: #888;
      margin-top: 6px;
      text-align: center;
    }

    /* ê°€ì¡± êµ¬ì„±ì› ì˜ì—­ ìŠ¤íƒ€ì¼ */
    .family-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .family-input {
      flex: 1;
    }

    /* ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì˜ì—­ */
    .admin-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      margin-top: 4px;
    }

    .admin-row input[type="password"] {
      flex: 1;
      padding: 8px 10px;
      font-size: 0.9rem;
    }

    .admin-row button {
      width: auto;
      padding: 8px 12px;
      font-size: 0.9rem;
    }

    .admin-status {
      font-size: 0.8rem;
      color: #666;
      min-height: 16px;
    }

    /* ê²€ìƒ‰ ì„¹ì…˜ */
    .search-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .search-row input[type="text"] {
      flex: 1;
      padding: 8px 10px;
      font-size: 0.9rem;
    }

    .search-row button {
      width: auto;
      padding: 8px 12px;
      font-size: 0.9rem;
    }

    .list-status {
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 8px;
      min-height: 16px;
    }

    /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) */
    .table-wrapper {
      width: 100%;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      min-width: 700px; /* ì‚¬ì§„ ì»¬ëŸ¼ ì¶”ê°€ë¡œ ì¡°ê¸ˆ ë„“ê²Œ */
    }

    thead {
      background: #f0f0f0;
    }

    th, td {
      padding: 6px;
      border-bottom: 1px solid #e0e0e0;
      text-align: left;
      word-break: break-word;
    }

    tr:hover {
      background: #fafafa;
    }

    /* ì‚¬ì§„ ì—…ë¡œë“œ/ì´¬ì˜ ì˜ì—­ */
    .photo-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .photo-buttons .small-button {
      width: auto;
    }

    .photo-preview {
      margin-top: 8px;
      text-align: center;
    }

    .photo-preview img {
      max-width: 100%;
      max-height: 200px;
      border-radius: 6px;
      border: 1px solid #ddd;
      object-fit: contain;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ğŸ”‘ ì´ ì œëª©ì„ 1ì´ˆ ì•ˆì— 5ë²ˆ í´ë¦­í•˜ë©´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì˜ì—­ì´ ë‚˜íƒ€ë‚¨ -->
    <h1 id="pageTitle">ê°œì¸ì •ë³´ ì…ë ¥</h1>

    <!-- (1) ê¸°ì¡´ ì„±ë„ ë“±ë¡ í¼ -->
    <form id="infoForm">
      <!-- header_row: ì‹œíŠ¸ í—¤ë”ê°€ 1í–‰ì´ë©´ ê·¸ëŒ€ë¡œ 1 -->
      <input type="hidden" name="header_row" value="1">

      <div class="field">
        <label for="mokjang">ëª©ì¥</label>
        <input 
          type="text" 
          id="mokjang" 
          name="ëª©ì¥" 
        >
      </div>

      <div class="field">
        <label for="name">ì´ë¦„</label>
        <input type="text" id="name" name="ì´ë¦„" required>
      </div>

      <div class="field">
        <label for="phone">ì „í™”ë²ˆí˜¸</label>
        <input type="text" id="phone" name="ì „í™”ë²ˆí˜¸">
      </div>

      <div class="field">
        <label for="address">ì£¼ì†Œ</label>
        <input type="text" id="address" name="ì£¼ì†Œ">
      </div>

      <div class="field">
        <label for="email">ì´ë©”ì¼</label>
        <input type="email" id="email" name="ì´ë©”ì¼">
      </div>

      <div class="field">
        <label for="birth">ìƒë…„ì›”ì¼</label>
        <input type="date" id="birth" name="ìƒë…„ì›”ì¼">
      </div>

      <!-- ğŸ”¹ ì‚¬ì§„ ì´¬ì˜ / ì—…ë¡œë“œ ì˜ì—­ -->
      <div class="field">
        <label>ì‚¬ì§„</label>

        <div class="photo-buttons">
          <button type="button" id="btnTakePhoto" class="small-button">ğŸ“· ì‚¬ì§„ ì´¬ì˜</button>
          <button type="button" id="btnUploadPhoto" class="small-button">ğŸ–¼ ì‚¬ì§„ ì—…ë¡œë“œ</button>
        </div>

        <!-- ì‹¤ì œ íŒŒì¼ ì…ë ¥ (ìˆ¨ê¹€) -->
        <input
          type="file"
          id="photoCamera"
          accept="image/*"
          capture="environment"
          style="display:none;"
        >
        <input
          type="file"
          id="photoFile"
          accept="image/*"
          style="display:none;"
        >

        <!-- ë¯¸ë¦¬ë³´ê¸° -->
        <div class="photo-preview" id="photoPreviewWrap" style="display:none;">
          <img id="photoPreview" alt="ì„ íƒëœ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°">
        </div>
      </div>

      <!-- ê°€ì¡± êµ¬ì„±ì› ì˜ì—­ -->
      <div class="field">
        <label>ê°€ì¡± êµ¬ì„±ì›</label>

        <div id="familyList">
          <div class="family-row">
            <input type="text" name="ê°€ì¡±ì´ë¦„[]" placeholder="ì´ë¦„" class="family-input">
            <input type="text" name="ê°€ì¡±ê´€ê³„[]" placeholder="ê´€ê³„(ì˜ˆ: ì–´ë¨¸ë‹ˆ, ì•„ë²„ì§€, ì•„ë“¤)" class="family-input">
          </div>
        </div>

        <button type="button" id="addFamily" class="small-button">+ êµ¬ì„±ì› ì¶”ê°€</button>
      </div>

      <button type="submit" id="submitBtn">ì œì¶œí•˜ê¸°</button>

      <div id="result" class="result"></div>
      <div class="small">ëª¨ë“  ì •ë³´ê°€ ì˜¬ë°”ë¥¸ì§€ ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•´ì£¼ì„¸ìš”.</div>
      <div class="small">ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì‹¤ ê²½ìš°, 1-2ë¶„ì˜ ì‹œê°„ì´ ì†Œìš”ë©ë‹ˆë‹¤.</div>
    </form>

    <!-- êµ¬ë¶„ì„  -->
    <hr style="margin: 20px 0; border: none; border-top: 1px solid #eee;">

    <!-- (2) ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì˜ì—­ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
    <h2></h2>
    <div class="field" id="adminSection" style="display:none;">
      <label for="adminPassword">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´ ê²€ìƒ‰ ê¸°ëŠ¥ì´ í™œì„±í™”ë©ë‹ˆë‹¤.</label>
      <div class="admin-row">
        <input type="password" id="adminPassword" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸">
        <button type="button" id="adminLoginBtn">ê²€ìƒ‰ í™œì„±í™”</button>
      </div>
      <div id="adminStatus" class="admin-status"></div>
    </div>

    <!-- (3) ê²€ìƒ‰ + ëª©ë¡ ì˜ì—­ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
    <div id="searchArea" style="display:none;">
      <div class="search-row">
        <input type="text" id="searchName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê¸¸ë™)" disabled>
        <button type="button" id="searchBtn" disabled>ê²€ìƒ‰</button>
        <button type="button" id="refreshBtn" disabled>ì „ì²´ ìƒˆë¡œê³ ì¹¨</button>
      </div>

      <div id="listStatus" class="list-status">ê´€ë¦¬ì ëª¨ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.</div>

      <div class="table-wrapper" id="tableWrapper" style="display:none;">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>ëª©ì¥</th>
              <th>ì´ë¦„</th>
              <th>ì „í™”ë²ˆí˜¸</th>
              <th>ì£¼ì†Œ</th>
              <th>ì´ë©”ì¼</th>
              <th>ìƒë…„ì›”ì¼</th>
              <th>ê°€ì¡±ì •ë³´</th>
              <th>ì‚¬ì§„</th>
            </tr>
          </thead>
          <tbody id="data-body">
            <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸° ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // ğŸ” ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸
    const ADMIN_PASSWORD = "Antioch19428";

    // ğŸ”— Apps Script ì›¹ì•± URL
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyN86SPJiewqgLf5RqrDd2OxdR4GDsX5IOzKi1vJEZ0ZDxDrd3mnVt5S7njOtPsRRBs7A/exec";

    // í¼ ìš”ì†Œ
    const form = document.getElementById('infoForm');
    const resultEl = document.getElementById('result');
    const submitBtn = document.getElementById('submitBtn');

    // ê°€ì¡± êµ¬ì„±ì› ê´€ë ¨
    const addFamilyBtn = document.getElementById('addFamily');
    const familyList = document.getElementById('familyList');

    // ê´€ë¦¬ì ê´€ë ¨
    const pageTitle = document.getElementById('pageTitle');
    const adminSection = document.getElementById('adminSection');
    const adminPasswordInput = document.getElementById('adminPassword');
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const adminStatus = document.getElementById('adminStatus');

    // ê²€ìƒ‰ ê´€ë ¨
    const searchArea = document.getElementById('searchArea');
    const searchNameInput = document.getElementById('searchName');
    const searchBtn = document.getElementById('searchBtn');
    const refreshBtn = document.getElementById('refreshBtn');
    const listStatus = document.getElementById('listStatus');
    const tableWrapper = document.getElementById('tableWrapper');
    const tbody = document.getElementById('data-body');

    // ì‚¬ì§„ ê´€ë ¨
    const btnTakePhoto = document.getElementById('btnTakePhoto');
    const btnUploadPhoto = document.getElementById('btnUploadPhoto');
    const photoCamera = document.getElementById('photoCamera');
    const photoFile = document.getElementById('photoFile');
    const photoPreviewWrap = document.getElementById('photoPreviewWrap');
    const photoPreview = document.getElementById('photoPreview');

    // ìƒíƒœ
    let allData = [];
    let isAdmin = false;

    // ì‚¬ì§„ ë°ì´í„° (Base64 + ë©”íƒ€ì •ë³´)
    let photoData = "";
    let photoMimeType = "";
    let photoFileName = "";

    // ê²€ìƒ‰ ì˜ì—­ í™œì„±/ë¹„í™œì„± í•¨ìˆ˜
    function setSearchEnabled(enabled) {
      searchNameInput.disabled = !enabled;
      searchBtn.disabled = !enabled;
      refreshBtn.disabled = !enabled;
      tableWrapper.style.display = enabled ? "block" : "none";
    }

    // ì œëª© 5ë²ˆ í´ë¦­í•˜ë©´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì˜ì—­ ë‚˜íƒ€ë‚˜ê¸°
    let titleClickCount = 0;
    let titleClickTimer = null;

    pageTitle.addEventListener('click', () => {
      titleClickCount++;

      if (!titleClickTimer) {
        titleClickTimer = setTimeout(() => {
          titleClickCount = 0;
          titleClickTimer = null;
        }, 1000); // 1ì´ˆ ì•ˆì— 5ë²ˆ í´ë¦­
      }

      if (titleClickCount >= 5) {
        adminSection.style.display = "block";
        adminStatus.textContent = "ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
        adminStatus.style.color = "#666";

        clearTimeout(titleClickTimer);
        titleClickTimer = null;
        titleClickCount = 0;
      }
    });

    // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ í™•ì¸
    adminLoginBtn.addEventListener('click', () => {
      const inputPw = adminPasswordInput.value.trim();
      if (!inputPw) {
        adminStatus.textContent = "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
        adminStatus.style.color = "#d9534f";
        return;
      }

      if (inputPw === ADMIN_PASSWORD) {
        isAdmin = true;
        adminStatus.textContent = "ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.";
        adminStatus.style.color = "#1b8c3f";

        // ê²€ìƒ‰ ì˜ì—­ ì—´ê¸° + í™œì„±í™”
        searchArea.style.display = "block";
        setSearchEnabled(true);
        listStatus.textContent = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...";

        // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ë§‰ê¸° (ì„ íƒ)
        adminPasswordInput.disabled = true;
        adminLoginBtn.disabled = true;

        // ë°ì´í„° ë¡œë“œ
        loadData();
      } else {
        isAdmin = false;
        adminStatus.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.";
        adminStatus.style.color = "#d9534f";
        setSearchEnabled(false);
        searchArea.style.display = "none";
        listStatus.textContent = "ê´€ë¦¬ì ëª¨ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.";
      }
    });

    // "+ êµ¬ì„±ì› ì¶”ê°€" ëˆŒë €ì„ ë•Œ ìƒˆë¡œìš´ ì…ë ¥ì¹¸ ì¶”ê°€
    addFamilyBtn.addEventListener('click', () => {
      const row = document.createElement('div');
      row.className = 'family-row';
      row.innerHTML = `
        <input type="text" name="ê°€ì¡±ì´ë¦„[]" placeholder="ì´ë¦„" class="family-input">
        <input type="text" name="ê°€ì¡±ê´€ê³„[]" placeholder="ê´€ê³„(ì˜ˆ: ì–´ë¨¸ë‹ˆ, ì•„ë²„ì§€, ì•„ë“¤)" class="family-input">
      `;
      familyList.appendChild(row);
    });

    // ì‚¬ì§„ ì„ íƒ/ì´¬ì˜ ê³µí†µ ì²˜ë¦¬
    function handlePhotoFile(file) {
      if (!file) return;

      photoMimeType = file.type || "image/jpeg";
      photoFileName = file.name || ("photo_" + Date.now() + ".jpg");

      const reader = new FileReader();
      reader.onload = (e) => {
        photoData = e.target.result; // dataURL (data:image/...;base64,....)
        photoPreview.src = photoData;
        photoPreviewWrap.style.display = "block";
      };
      reader.readAsDataURL(file);
    }

    if (btnTakePhoto) {
      btnTakePhoto.addEventListener('click', () => {
        photoCamera.click();
      });
    }
    if (btnUploadPhoto) {
      btnUploadPhoto.addEventListener('click', () => {
        photoFile.click();
      });
    }
    if (photoCamera) {
      photoCamera.addEventListener('change', () => {
        const file = photoCamera.files && photoCamera.files[0];
        handlePhotoFile(file);
      });
    }
    if (photoFile) {
      photoFile.addEventListener('change', () => {
        const file = photoFile.files && photoFile.files[0];
        handlePhotoFile(file);
      });
    }

    // í¼ ì œì¶œ (ì‹œíŠ¸ + ì‚¬ì§„ ì €ì¥)
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      submitBtn.disabled = true;
      submitBtn.textContent = "ì „ì†¡ ì¤‘...";

      resultEl.textContent = "";
      resultEl.className = "result";

      try {
        const formData = new FormData(form);

        // ê°€ì¡±ì •ë³´ ë¬¸ìì—´ ë§Œë“¤ê¸°
        const familyRows = familyList.querySelectorAll('.family-row');
        const familyParts = [];

        familyRows.forEach(row => {
          const nameInput = row.querySelector('input[name="ê°€ì¡±ì´ë¦„[]"]');
          const relInput  = row.querySelector('input[name="ê°€ì¡±ê´€ê³„[]"]');

          const name = nameInput ? nameInput.value.trim() : "";
          const rel  = relInput ? relInput.value.trim() : "";

          if (!name && !rel) return;

          if (name && rel) {
            familyParts.push(`${name}(${rel})`);
          } else if (name) {
            familyParts.push(name);
          } else {
            familyParts.push(`(${rel})`);
          }
        });

        const familyInfo = familyParts.join(", "); // ì˜ˆ: "í™ê¸¸ë™(ì•„ë“¤), ê¹€ì˜í¬(ì–´ë¨¸ë‹ˆ)"

        // ì „ì†¡ìš© íŒŒë¼ë¯¸í„°
        const params = new URLSearchParams();
        for (const [key, value] of formData.entries()) {
          // ë°°ì—´ í•„ë“œëŠ” ì§ì ‘ ì•ˆ ë³´ë‚´ê³  í•©ì³ì„œ ë³´ëƒ„
          if (key === "ê°€ì¡±ì´ë¦„[]" || key === "ê°€ì¡±ê´€ê³„[]") continue;
          params.append(key, value);
        }
        // ê°€ì¡±ì •ë³´
        params.append("ê°€ì¡±ì •ë³´", familyInfo);

        // ì‚¬ì§„ ë°ì´í„° (ìˆìœ¼ë©´ ì¶”ê°€)
        if (photoData) {
          params.append("photoData", photoData);
          params.append("photoMimeType", photoMimeType || "");
          params.append("photoFileName", photoFileName || "");
        }

        await fetch(WEB_APP_URL, {
          method: "POST",
          body: params,
          mode: "no-cors" // CORS ì˜¤ë¥˜ë¥¼ í”¼í•˜ê¸° ìœ„í•œ ì„¤ì • (ì‘ë‹µì€ ì½ì§€ ì•ŠìŒ)
        });

        resultEl.textContent = "ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!";
        resultEl.classList.add("success");

        form.reset();
        familyList.innerHTML = `
          <div class="family-row">
            <input type="text" name="ê°€ì¡±ì´ë¦„[]" placeholder="ì´ë¦„" class="family-input">
            <input type="text" name="ê°€ì¡±ê´€ê³„[]" placeholder="ê´€ê³„(ì˜ˆ: ì–´ë¨¸ë‹ˆ, ì•„ë²„ì§€, ì•„ë“¤)" class="family-input">
          </div>
        `;

        // ì‚¬ì§„ ìƒíƒœ ë¦¬ì…‹
        photoData = "";
        photoMimeType = "";
        photoFileName = "";
        photoPreview.src = "";
        photoPreviewWrap.style.display = "none";

        if (isAdmin) {
          loadData();
        }
      } catch (error) {
        console.error(error);
        resultEl.textContent = "ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
        resultEl.classList.add("error");
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "ì œì¶œí•˜ê¸°";
      }
    });

    // ì‹œíŠ¸ì—ì„œ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    async function loadData() {
      if (!isAdmin) {
        listStatus.textContent = "ê´€ë¦¬ì ëª¨ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.";
        return;
      }

      listStatus.textContent = "ì‹œíŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...";
      tbody.innerHTML = "";

      try {
        const res = await fetch(WEB_APP_URL);
        const data = await res.json();

        allData = Array.isArray(data) ? data : [];
        listStatus.textContent = `ì´ ${allData.length}ëª… ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰í•´ ë³´ì„¸ìš”.`;
        renderTable(allData);
      } catch (error) {
        console.error(error);
        listStatus.textContent = "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
    }

    // í…Œì´ë¸” ë Œë”ë§
    function renderTable(rows) {
      tbody.innerHTML = "";

      if (!rows || rows.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9">í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }

      rows.forEach((row, index) => {
        const familyInfo = row["ê°€ì¡±ì •ë³´"] || "";
        const photoUrl = row["ì‚¬ì§„URL"] || row["ì‚¬ì§„"] || "";

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${row["ëª©ì¥"] || ""}</td>
          <td>${row["ì´ë¦„"] || ""}</td>
          <td>${row["ì „í™”ë²ˆí˜¸"] || ""}</td>
          <td>${row["ì£¼ì†Œ"] || ""}</td>
          <td>${row["ì´ë©”ì¼"] || ""}</td>
          <td>${row["ìƒë…„ì›”ì¼"] || ""}</td>
          <td>${familyInfo}</td>
          <td>${photoUrl ? `<a href="${photoUrl}" target="_blank">ë³´ê¸°</a>` : ""}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ì´ë¦„ìœ¼ë¡œ í•„í„°ë§
    function filterByName() {
      if (!isAdmin) {
        listStatus.textContent = "ê´€ë¦¬ìë§Œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
        return;
      }

      const keyword = searchNameInput.value.trim();
      if (!keyword) {
        listStatus.textContent = "ê²€ìƒ‰ì–´ê°€ ì—†ìŠµë‹ˆë‹¤. ì „ì²´ ëª©ë¡ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.";
        renderTable(allData);
        return;
      }

      const lower = keyword.toLowerCase();

      const filtered = allData.filter(row => {
        const name = (row["ì´ë¦„"] || "").toString().toLowerCase();
        return name.includes(lower);
      });

      listStatus.textContent = `"${keyword}" ê²€ìƒ‰ ê²°ê³¼: ${filtered.length}ëª…`;
      renderTable(filtered);
    }

    // ê²€ìƒ‰ ë²„íŠ¼ & ì—”í„° ì—°ë™
    searchBtn.addEventListener('click', filterByName);
    refreshBtn.addEventListener('click', loadData);
    searchNameInput.addEventListener('keyup', (e) => {
      if (e.key === "Enter") filterByName();
    });

    // ì´ˆê¸° ìƒíƒœ
    window.addEventListener('DOMContentLoaded', () => {
      setSearchEnabled(false);
      searchArea.style.display = "none";
      adminSection.style.display = "none";
      tableWrapper.style.display = "none";
      listStatus.textContent = "ê´€ë¦¬ì ëª¨ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.";
    });
  </script>
</body>
</html>
